# Process barcoded sequencing libraries with UMIs

This script processes libraries that contain cell barcodes and UMIs in one read, and 3' sequences in the other. It was inititally designed for processing data from the now-defunct fluidigm C1 800-cell chips. This script parses read1, generating cell-specific fastq files for read2 with UMIs appended to the read headers in read2. Each demultiplexed sample in then aligned to a reference genome using STAR (Dobin _et al._, 2013) and PCR duplicates are removed using UMI-tools (Smith _et al._ 2017).

### Installing

Use the environment file to create a conda environment locally. It will install all required python packages and executables into a conda environment.

```
conda env create -f environment.yml
```

## Getting Started

This python script typically operates on large files, so some example data can be generated by interactively running the Make_test_dataset.ipynb notebook.
Once that has been done, run the following command to generate sample-specific umi-collapsed gene counts, where samples are defined by cell barcodes.

```
python process_800_cell_chip.py test/test_R1.fastq test/test_R2.fastq test/STAR_GENOME/ --gff_filename test/test.gtf --overwrite_option write
```

## To do:

- Create tests with small memory fingerprint
- fill out function documentation
- Extend logging to keep track of read counts

## Authors

- **Rob Carter** - (r.andrew.carter@gmail.com)

## License

This project is licensed under the MIT License - see the [LICENSE.md](LICENSE.md) file for details

## Acknowledgments

- Hat tip to the many authors of the python packages and bioinformatics tools used in this script! There are too many to name here.

## References

    Smith T, Heger A, Sudbery I. 2017. UMI-tools: modeling sequencing errors in Unique
    Molecular Identifiers to improve quantification accuracy. Genome Res. 27:491-499

    Dobin A, Davis CA, Schlesinger F, Drenkow J, Zaleski C, Jha S, Batut P, Chaisson M,
    Gingeras TR. 2013. STAR: ultrafast universal RNA-seq aligner. Bioinformatics. 29:15-21
